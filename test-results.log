
> netpost-v2@1.0.0 test
> turbo test

• Packages in scope: @netpost/config, @netpost/shared-types, @netpost/ui, mobile, web
• Running test in 5 packages
• Remote caching disabled
@netpost/shared-types:build: cache hit, replaying logs dfc5b32dfef1b853
@netpost/shared-types:build: 
@netpost/shared-types:build: > @netpost/shared-types@0.1.0 build
@netpost/shared-types:build: > tsup
@netpost/shared-types:build: 
@netpost/shared-types:build: CLI Building entry: src/index.ts
@netpost/shared-types:build: CLI Using tsconfig: tsconfig.json
@netpost/shared-types:build: CLI tsup v8.5.0
@netpost/shared-types:build: CLI Using tsup config: /home/optiks/dev/netpost-v2/packages/shared-types/tsup.config.ts
@netpost/shared-types:build: CLI Target: es2020
@netpost/shared-types:build: CLI Cleaning output folder
@netpost/shared-types:build: CJS Build start
@netpost/shared-types:build: ESM Build start
@netpost/shared-types:build: ESM dist/index.js     3.79 KB
@netpost/shared-types:build: ESM dist/index.js.map 23.44 KB
@netpost/shared-types:build: ESM ⚡️ Build success in 47ms
@netpost/shared-types:build: CJS dist/index.cjs     5.47 KB
@netpost/shared-types:build: CJS dist/index.cjs.map 26.08 KB
@netpost/shared-types:build: CJS ⚡️ Build success in 49ms
@netpost/shared-types:build: DTS Build start
@netpost/shared-types:build: DTS ⚡️ Build success in 3432ms
@netpost/shared-types:build: DTS dist/index.d.cts 26.59 KB
@netpost/shared-types:build: DTS dist/index.d.ts  26.59 KB
@netpost/config:build: cache hit, replaying logs 7ac1324e4b94c159
@netpost/config:build: 
@netpost/config:build: > @netpost/config@0.1.0 build
@netpost/config:build: > tsup
@netpost/config:build: 
@netpost/config:build: CLI Building entry: src/index.ts
@netpost/config:build: CLI Using tsconfig: tsconfig.json
@netpost/config:build: CLI tsup v8.5.0
@netpost/config:build: CLI Using tsup config: /home/optiks/dev/netpost-v2/packages/config/tsup.config.ts
@netpost/config:build: CLI Target: es2020
@netpost/config:build: CLI Cleaning output folder
@netpost/config:build: CJS Build start
@netpost/config:build: ESM Build start
@netpost/config:build: ESM dist/index.js     4.84 KB
@netpost/config:build: ESM dist/index.js.map 8.14 KB
@netpost/config:build: ESM ⚡️ Build success in 23ms
@netpost/config:build: CJS dist/index.cjs     6.05 KB
@netpost/config:build: CJS dist/index.cjs.map 8.50 KB
@netpost/config:build: CJS ⚡️ Build success in 24ms
@netpost/config:build: DTS Build start
@netpost/config:build: DTS ⚡️ Build success in 3342ms
@netpost/config:build: DTS dist/index.d.cts 2.86 KB
@netpost/config:build: DTS dist/index.d.ts  2.86 KB
@netpost/ui:build: cache hit, replaying logs 4b9ce330f3489f0a
@netpost/ui:build: 
@netpost/ui:build: > @netpost/ui@0.1.0 build
@netpost/ui:build: > tsup
@netpost/ui:build: 
@netpost/ui:build: CLI Building entry: src/index.ts
@netpost/ui:build: CLI Using tsconfig: tsconfig.json
@netpost/ui:build: CLI tsup v8.5.0
@netpost/ui:build: CLI Using tsup config: /home/optiks/dev/netpost-v2/packages/ui/tsup.config.ts
@netpost/ui:build: CLI Target: es2020
@netpost/ui:build: CLI Cleaning output folder
@netpost/ui:build: CJS Build start
@netpost/ui:build: ESM Build start
@netpost/ui:build: ESM dist/index.js     22.60 KB
@netpost/ui:build: ESM dist/index.js.map 37.41 KB
@netpost/ui:build: ESM ⚡️ Build success in 41ms
@netpost/ui:build: CJS dist/index.cjs     27.39 KB
@netpost/ui:build: CJS dist/index.cjs.map 38.64 KB
@netpost/ui:build: CJS ⚡️ Build success in 43ms
@netpost/ui:build: DTS Build start
@netpost/ui:build: DTS ⚡️ Build success in 4341ms
@netpost/ui:build: DTS dist/index.d.cts 7.99 KB
@netpost/ui:build: DTS dist/index.d.ts  7.99 KB
mobile:test: cache miss, executing 873d2b95107e25e3
web:test: cache miss, executing 2b6e64f0c4d24d0c
web:test: 
web:test: > web@0.1.0 test
web:test: > vitest
web:test: 
mobile:test: 
mobile:test: > mobile@1.0.0 test
mobile:test: > jest
mobile:test: 
web:test: 
web:test:  RUN  v3.2.4 /home/optiks/dev/netpost-v2/apps/web
web:test: 
mobile:test: PASS src/services/__tests__/sourcingService.test.ts
mobile:test: PASS __tests__/App.test.tsx
mobile:test: 
mobile:test: Test Suites: 2 passed, 2 total
mobile:test: Tests:       4 passed, 4 total
mobile:test: Snapshots:   0 total
mobile:test: Time:        1.455 s
mobile:test: Ran all test suites.
web:test:  ✓ src/lib/subscription/__tests__/integration.test.ts (12 tests) 9ms
web:test: stdout | src/lib/subscription/__tests__/email-integration.test.ts > Email Integration Tests > Welcome Email > should send welcome email with beta code
web:test: 📧 Sending welcome email for beta subscription to John Doe (test@example.com)
web:test: 
web:test:  ✓ lib/auth/__tests__/auth-integration.test.ts (10 tests) 18ms
web:test: stdout | src/lib/subscription/__tests__/email-integration.test.ts > Email Integration Tests > Welcome Email > should handle email sending failure gracefully
web:test: 📧 Sending welcome email for beta subscription to John Doe (test@example.com)
web:test: 
web:test: stderr | src/lib/subscription/__tests__/email-integration.test.ts > Email Integration Tests > Welcome Email > should handle email sending failure gracefully
web:test: Failed to send welcome email: Error: Email service unavailable
web:test:     at [90m/home/optiks/dev/netpost-v2/apps/web/[39msrc/lib/subscription/__tests__/email-integration.test.ts:58:9
web:test:     at file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
web:test:     at file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
web:test:     at file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
web:test:     at new Promise (<anonymous>)
web:test:     at runWithTimeout (file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)
web:test:     at runTest (file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12)
web:test: [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
web:test:     at runSuite (file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8)
web:test:     at runSuite (file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8)
web:test: 
web:test: stdout | src/lib/subscription/__tests__/email-integration.test.ts > Email Integration Tests > Usage Warning Email > should send usage warning with correct percentage
web:test: 📧 Sending usage warning for inventory_items: 85/100 to Jane Smith (user@example.com)
web:test: 
web:test: stdout | src/lib/subscription/__tests__/email-integration.test.ts > Email Integration Tests > Usage Warning Email > should calculate usage percentage correctly
web:test: 📧 Sending usage warning for api_calls: 750/1000 to Test User (user@example.com)
web:test: 
web:test: stdout | src/lib/subscription/__tests__/email-integration.test.ts > Email Integration Tests > Payment Failed Email > should send payment failed notification with amount
web:test: 📧 Sending payment failed notification for $29.99 to John Customer (customer@example.com)
web:test: 
web:test:  ✓ lib/auth/__tests__/auth-utils.test.ts (36 tests) 28ms
web:test: stdout | src/lib/subscription/__tests__/email-integration.test.ts > Email Integration Tests > Subscription Change Emails > should send upgrade confirmation
web:test: 📧 Sending subscription upgrade notification to Upgrading User (user@example.com)
web:test: 
web:test: stdout | src/lib/subscription/__tests__/email-integration.test.ts > Email Integration Tests > Subscription Change Emails > should send cancellation confirmation
web:test: 📧 Sending subscription canceled notification to Canceling User (user@example.com)
web:test: 
web:test: stdout | src/lib/subscription/__tests__/email-integration.test.ts > Email Integration Tests > Beta Feedback Email > should send beta feedback request
web:test: 📧 Sending beta feedback request to Beta Tester (beta@example.com)
web:test: 
web:test: stdout | src/lib/subscription/__tests__/email-integration.test.ts > Email Integration Tests > Environment Variable Handling > should use environment variables in email context
web:test: 📧 Sending welcome email for beta subscription to Test User (test@example.com)
web:test: 
web:test: stdout | src/lib/subscription/__tests__/email-integration.test.ts > Email Integration Tests > Error Handling > should handle network errors
web:test: stderr | src/lib/subscription/__tests__/email-integration.test.ts > Email Integration Tests > Error Handling > should handle network errors
web:test: Failed to send welcome email: Error: Network timeout
web:test:     at [90m/home/optiks/dev/netpost-v2/apps/web/[39msrc/lib/subscription/__tests__/email-integration.test.ts:270:9
web:test: 📧 Sending welcome email for beta subscription to Test User (test@example.com)
web:test:     at file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
web:test: 
web:test: stdout | src/lib/subscription/__tests__/email-integration.test.ts > Email Integration Tests > Error Handling > should handle email service configuration errors
web:test: 📧 Sending payment failed notification for $19.99 to Test User (test@example.com)
web:test:     at file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
web:test: 
web:test:     at file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
web:test:     at new Promise (<anonymous>)
web:test:     at runWithTimeout (file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)
web:test:     at runTest (file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12)
web:test: [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
web:test:     at runSuite (file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8)
web:test:     at runSuite (file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8)
web:test: 
web:test: stderr | src/lib/subscription/__tests__/email-integration.test.ts > Email Integration Tests > Error Handling > should handle email service configuration errors
web:test: Failed to send payment failed email: Error: Invalid API key
web:test:     at [90m/home/optiks/dev/netpost-v2/apps/web/[39msrc/lib/subscription/__tests__/email-integration.test.ts:285:9
web:test:     at file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
web:test:     at file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
web:test:     at file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
web:test:     at new Promise (<anonymous>)
web:test:     at runWithTimeout (file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10)
web:test:     at runTest (file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12)
web:test: [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
web:test:     at runSuite (file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8)
web:test:     at runSuite (file:///home/optiks/dev/netpost-v2/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8)
web:test: 
web:test:  ✓ src/lib/subscription/__tests__/email-integration.test.ts (11 tests) 49ms
web:test: 
web:test: ⎯⎯⎯⎯⎯⎯ Failed Suites 4 ⎯⎯⎯⎯⎯⎯⎯
web:test: 
web:test:  FAIL  src/lib/delisting/__tests__/delisting-engine.test.ts [ src/lib/delisting/__tests__/delisting-engine.test.ts ]
web:test: Error: Failed to resolve import "@/lib/supabase/client" from "src/lib/delisting/__tests__/delisting-engine.test.ts". Does the file exist?
web:test:   Plugin: vite:import-analysis
web:test:   File: /home/optiks/dev/netpost-v2/apps/web/src/lib/delisting/__tests__/delisting-engine.test.ts:7:0
web:test:   22 |  }));
web:test:   23 |  const __vi_import_0__ = await import("../delisting-engine");
web:test:   24 |  const __vi_import_1__ = await import("@/lib/supabase/client");
web:test:      |                                       ^
web:test:   25 |  import { describe, test, expect, beforeEach, afterEach, vi } from "vitest";
web:test:   26 |  
web:test:  ❯ TransformPluginContext._formatLog ../../node_modules/vite/dist/node/chunks/dep-M_KD0XSK.js:31527:43
web:test:  ❯ TransformPluginContext.error ../../node_modules/vite/dist/node/chunks/dep-M_KD0XSK.js:31524:14
web:test:  ❯ normalizeUrl ../../node_modules/vite/dist/node/chunks/dep-M_KD0XSK.js:29996:18
web:test:  ❯ ../../node_modules/vite/dist/node/chunks/dep-M_KD0XSK.js:30054:32
web:test:  ❯ TransformPluginContext.transform ../../node_modules/vite/dist/node/chunks/dep-M_KD0XSK.js:30022:4
web:test:  ❯ EnvironmentPluginContainer.transform ../../node_modules/vite/dist/node/chunks/dep-M_KD0XSK.js:31325:14
web:test:  ❯ loadAndTransform ../../node_modules/vite/dist/node/chunks/dep-M_KD0XSK.js:26407:26
web:test: 
web:test: ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/4]⎯
web:test: 
web:test:  FAIL  src/lib/services/__tests__/notification-service.test.ts [ src/lib/services/__tests__/notification-service.test.ts ]
web:test: Error: Failed to resolve import "@/lib/supabase/client" from "src/lib/services/__tests__/notification-service.test.ts". Does the file exist?
web:test:   Plugin: vite:import-analysis
web:test:   File: /home/optiks/dev/netpost-v2/apps/web/src/lib/services/__tests__/notification-service.test.ts:7:0
web:test:   10 |  }));
web:test:   11 |  const __vi_import_0__ = await import("../notification-service");
web:test:   12 |  const __vi_import_1__ = await import("@/lib/supabase/client");
web:test:      |                                       ^
web:test:   13 |  import { describe, test, expect, beforeEach, afterEach, vi } from "vitest";
web:test:   14 |  
web:test:  ❯ TransformPluginContext._formatLog ../../node_modules/vite/dist/node/chunks/dep-M_KD0XSK.js:31527:43
web:test:  ❯ TransformPluginContext.error ../../node_modules/vite/dist/node/chunks/dep-M_KD0XSK.js:31524:14
web:test:  ❯ normalizeUrl ../../node_modules/vite/dist/node/chunks/dep-M_KD0XSK.js:29996:18
web:test:  ❯ ../../node_modules/vite/dist/node/chunks/dep-M_KD0XSK.js:30054:32
web:test:  ❯ TransformPluginContext.transform ../../node_modules/vite/dist/node/chunks/dep-M_KD0XSK.js:30022:4
web:test:  ❯ EnvironmentPluginContainer.transform ../../node_modules/vite/dist/node/chunks/dep-M_KD0XSK.js:31325:14
web:test:  ❯ loadAndTransform ../../node_modules/vite/dist/node/chunks/dep-M_KD0XSK.js:26407:26
web:test: 
web:test: ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/4]⎯
web:test: 
web:test:  FAIL  src/lib/subscription/__tests__/feature-gates.test.ts [ src/lib/subscription/__tests__/feature-gates.test.ts ]
web:test: Error: Missing required Stripe environment variable: STRIPE_SECRET_KEY
web:test:  ❯ src/lib/subscription/stripe-service.ts:19:11
web:test:      17| for (const [key, value] of Object.entries(requiredEnvVars)) {
web:test:      18|   if (!value) {
web:test:      19|     throw new Error(`Missing required Stripe environment variable: ${k…
web:test:        |           ^
web:test:      20|   }
web:test:      21| }
web:test:  ❯ src/lib/subscription/feature-gates.ts:9:1
web:test: 
web:test: ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/4]⎯
web:test: 
web:test:  FAIL  src/lib/subscription/__tests__/subscription-service.test.ts [ src/lib/subscription/__tests__/subscription-service.test.ts ]
web:test: Error: Missing required Stripe environment variable: STRIPE_SECRET_KEY
web:test:  ❯ src/lib/subscription/stripe-service.ts:19:11
web:test:      17| for (const [key, value] of Object.entries(requiredEnvVars)) {
web:test:      18|   if (!value) {
web:test:      19|     throw new Error(`Missing required Stripe environment variable: ${k…
web:test:        |           ^
web:test:      20|   }
web:test:      21| }
web:test:  ❯ src/lib/subscription/subscription-service.ts:9:1
web:test: 
web:test: ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/4]⎯
web:test: 
web:test: 
web:test:  Test Files  4 failed | 4 passed (8)
web:test:       Tests  69 passed (69)
web:test:    Start at  20:49:58
web:test:    Duration  1.73s (transform 554ms, setup 798ms, collect 665ms, tests 103ms, environment 6.86s, prepare 1.22s)
web:test: 
web:test: npm error Lifecycle script `test` failed with error:
web:test: npm error code 1
web:test: npm error path /home/optiks/dev/netpost-v2/apps/web
web:test: npm error workspace web@0.1.0
web:test: npm error location /home/optiks/dev/netpost-v2/apps/web
web:test: npm error command failed
web:test: npm error command sh -c vitest
web:test: ERROR: command finished with error: command (/home/optiks/dev/netpost-v2/apps/web) /home/optiks/.nvm/versions/node/v22.18.0/bin/npm run test exited (1)
web#test: command (/home/optiks/dev/netpost-v2/apps/web) /home/optiks/.nvm/versions/node/v22.18.0/bin/npm run test exited (1)

 Tasks:    4 successful, 5 total
Cached:    3 cached, 5 total
  Time:    2.714s 
Failed:    web#test

 ERROR  run failed: command  exited (1)
